import{_,I,A as E,K as k,ae as P,af as R,H as C}from"./index.d7c3f1b2.js";const M=A=>(P("data-v-66673d26"),A=A(),R(),A),z=M(()=>C("div",null,"ExTuner",-1)),B=M(()=>C("canvas",{id:"guitar-tuner",height:"300"},null,-1)),U={name:"TunerTool"},N=Object.assign(U,{setup(A){var g=function(){this.VERSION="1.0",this.installArray(),this.installFloat32Array()};g.prototype={$:function(a){return document.getElementById(a)},virtual:function(){throw"call pure virtual function"},installFloat32Array:function(){Float32Array.prototype.max=function(){return Math.max.apply(null,this)},Float32Array.prototype.indexof=function(a){return Array.prototype.indexOf.call(this,a)},Float32Array.prototype.slice=function(a,s){return Array.prototype.slice.call(this,a,s)},Float32Array.prototype.select=function(a){for(var s=0;s<this.length;s++)this[s]=a(this[s])}},installArray:function(){Array.prototype.map=function(a){var s=new Array(this.length);for(var i in this)s[i]=a(this[i]);return s},Array.prototype.where=function(a){var s=new Array;for(var i in this)a(this[i])&&(s[i]=this[i]);return s}},getUserMediaFunction:function(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},isHtml5Compatible:function(){return!!this.getUserMediaFunction()},getUserMedia:function(a,s,i){return this.getUserMediaFunction().call(navigator,a,s,i)},createAudioContext:function(){var a=window.AudioContext||window.webkitAudioContext;return new a}},this.OnlineTuner=new g,function(){var a=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],s=function(t){for(var e=new Float32Array(t),r=0;r<e.length;r++)e[r]=.42-.5*Math.cos(2*Math.PI*r/(e.length-1))+.08*Math.cos(4*Math.PI*r/(e.length-1));return e},i=function(t){return 12*Math.log(t/440)/Math.LN2},n=function(t){return(t-2)/Math.abs(t-2)*Math.floor(Math.abs(t-2)/12)+4},o=function(t){var e=Math.round(t)%a.length;return e<0?a[12+e]:a[e]},l=function(t,e,r){this.highFrequency=r||350,this.precision=e||65536,this.controllers=t,this.audioContext=g.createAudioContext(),this.inputStream=new Float32Array(this.precision),this.fft=new g.FFT(this.precision,this.audioContext.sampleRate),this.scriptNode=this.audioContext.createScriptProcessor(Math.min(this.precision,16384),1,1);var u=this;this.scriptNode.onaudioprocess=function(c){var d=c.inputBuffer.getChannelData(0);u.update(d)},this.scriptNode.connect(this.audioContext.destination),this.input=null,this.window=s(this.precision)};l.prototype={install:function(t,e){if(!g.isHtml5Compatible()){e("Not html5 browser compliant");return}var r=this;g.getUserMedia({audio:!0},function(u){r.input=r.audioContext.createMediaStreamSource(u),r.input.connect(r.scriptNode),t()},function(u){e(u)})},update:function(t){this.inputStream.set(this.inputStream.subarray(this.precision)),this.inputStream.set(t,this.inputStream.length-t.length);for(var e=0;e<t.length;e++)this.inputStream[e]*=this.window[e];this.fft.forward(this.inputStream);for(var e=0;e<this.fft.spectrum.length;e++)this.fft.spectrum[e]*=this.microResponse(e);for(var e=0;e<this.controllers.length;e++)this.controllers[e].notify(this.getInfo())},getError:function(){return this.audioContext.sampleRate/this.precision},getData:function(){return this.fft.spectrum},getStepError:function(t){return i(t+this.getError())-i(t)},getInfo:function(){var t=this.getData().subarray(0,this.highFrequency/this.getError()),e=t.indexof(t.max())*this.getError();e==0&&(e=440);var r=i(e);return{frequency:e,step:r,error:this.getError(e),stepError:this.getStepError(e),note:o(r),octave:n(r)}},microResponse:function(t){return t*this.getError()<this.microphoneResponseFrequency?-1*.06*this.getError()*t+13:1}},g.Analyser=l}(),function(){var a=[-5,-10,-14,-19,-24,-29],s=["E","B","G","D","A","E"],i=function(l){var t=a.map(function(u){return Math.abs(u-l.step)}),e=t.indexOf(Math.min.apply(null,t)),r=a[e]-l.step;return Math.abs(r)-l.stepError<0&&(r=0),{string:e+1,note:s[e],delta:r}},n=function(){};n.prototype={notify:g.virtual};var o=function(l){n.call(this),this.widget=l};o.prototype={notify:function(l){var t=i(l);this.widget.show(-t.delta/5,t.note,"string "+t.string,l.note+""+l.octave+"("+Math.round(l.frequency)+"Hz)")}},g.Controller={GuitareTuner:o}}(),function(){function a(i,n){this.bufferSize=i,this.sampleRate=n,this.bandwidth=2/i*n/2,this.spectrum=new Float32Array(i/2),this.real=new Float32Array(i),this.imag=new Float32Array(i),this.peakBand=0,this.peak=0,this.getBandFrequency=function(o){return this.bandwidth*o+this.bandwidth/2},this.calculateSpectrum=function(){for(var o=this.spectrum,l=this.real,t=this.imag,e=2/this.bufferSize,r=Math.sqrt,u,c,d,f=0,v=i/2;f<v;f++)u=l[f],c=t[f],d=e*r(u*u+c*c),d>this.peak&&(this.peakBand=f,this.peak=d),o[f]=d}}function s(i,n){a.call(this,i,n),this.reverseTable=new Uint32Array(i);for(var o=1,l=i>>1,t;o<i;){for(t=0;t<o;t++)this.reverseTable[t+o]=this.reverseTable[t]+l;o=o<<1,l=l>>1}for(this.sinTable=new Float32Array(i),this.cosTable=new Float32Array(i),t=0;t<i;t++)this.sinTable[t]=Math.sin(-Math.PI/t),this.cosTable[t]=Math.cos(-Math.PI/t)}s.prototype={forward:function(i){var n=this.bufferSize,o=this.cosTable,l=this.sinTable,t=this.reverseTable,e=this.real,r=this.imag;this.spectrum;var u=Math.floor(Math.log(n)/Math.LN2);if(Math.pow(2,u)!==n)throw"Invalid buffer size, must be a power of 2.";if(n!==i.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+n+" Buffer Size: "+i.length;var c=1,d,f,v,m,y,w,h,S,p;for(p=0;p<n;p++)e[p]=i[t[p]],r[p]=0;for(;c<n;){d=o[c],f=l[c],v=1,m=0;for(var x=0;x<c;x++){for(p=x;p<n;)y=p+c,w=v*e[y]-m*r[y],h=v*r[y]+m*e[y],e[y]=e[p]-w,r[y]=r[p]-h,e[p]+=w,r[p]+=h,p+=c<<1;S=v,v=S*d-m*f,m=S*f+m*d}c=c<<1}return this.calculateSpectrum()},inverse:function(i,n){var o=this.bufferSize,l=this.cosTable,t=this.sinTable,e=this.reverseTable;this.spectrum,i=i||this.real,n=n||this.imag;var r=1,u,c,d,f,v,m,y,w,h;for(h=0;h<o;h++)n[h]*=-1;var S=new Float32Array(o),p=new Float32Array(o);for(h=0;h<i.length;h++)S[h]=i[e[h]],p[h]=n[e[h]];for(i=S,n=p;r<o;){u=l[r],c=t[r],d=1,f=0;for(var x=0;x<r;x++){for(h=x;h<o;)v=h+r,m=d*i[v]-f*n[v],y=d*n[v]+f*i[v],i[v]=i[h]-m,n[v]=n[h]-y,i[h]+=m,n[h]+=y,h+=r<<1;w=d,d=w*u-f*c,f=w*c+f*u}r=r<<1}var T=new Float32Array(o);for(h=0;h<o;h++)T[h]=i[h]/o;return T}},g.FFT=s}(),function(){var a=function(s,i,n,o,l){this.canvas=s,this.bgColor=i,this.deltaColor=n,this.okColor=o,this.fontColor=l,this.ctx=this.canvas.getContext("2d")};a.prototype={show:function(s,i,n,o){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,this.canvas.height/2),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,-Math.PI/2,-Math.PI/2+s*Math.PI,s<=0),this.ctx.lineTo(this.canvas.width/2,this.canvas.height/2),this.ctx.fillStyle=this.deltaColor,this.ctx.fill(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,4*this.canvas.width/10,0,2*Math.PI),this.ctx.fillStyle=s==0?this.okColor:this.bgColor,this.ctx.fill(),this.ctx.closePath(),this.ctx.font="70pt Arial",this.ctx.textAlign="center",this.ctx.fillStyle=this.fontColor,this.ctx.fillText(i,this.canvas.width/2,this.canvas.height/2+15),this.ctx.font="20pt Arial",this.ctx.textAlign="center",this.ctx.fillStyle=this.fontColor,this.ctx.fillText(n,this.canvas.width/2,this.canvas.height/2+55),this.ctx.font="15pt Arial",this.ctx.textAlign="center",this.ctx.fillStyle=this.fontColor,this.ctx.fillText(o,this.canvas.width/2,this.canvas.height/2+85)}},g.Widget={CircleWidget:a}}();const b={container:document.getElementById("guitar-tuner"),backgroundColor:"white",notOkayColor:"orange",okayColor:"green",fontColor:"black"};function F(){var a=[new g.Controller.GuitareTuner(new g.Widget.CircleWidget(b.container,b.backgroundColor,b.notOkayColor,b.okayColor,b.fontColor))];new g.Analyser(a).install(function(){console.log("Succesfully initialized")},function(s){console.error("Oops, this shouldn't happen",s)})}return F(),(a,s)=>(E(),I(k,null,[z,B],64))}});var q=_(N,[["__scopeId","data-v-66673d26"]]);export{q as default};
